# Exploitation Phase

## I. Mục tiêu

Trong giai đoạn **Reconnaissance**, chúng ta đã thu thập được các thông tin sau:

- **Các IP malicious thực hiện tấn công:**
  - `40.80.148.42`
  - `23.22.63.114`

- **Địa chỉ IP của webserver:**
  - `192.168.250.70`

- **CMS mà webserver sử dụng:**
  - Joomla

- **Một nỗ lực tấn công brute force đến từ IP:**
  - `23.22.63.114`

Trong giai đoạn Exploitation, chúng ta sẽ xem xét các khả năng tấn công brute force nhắm vào webserver và liệu attacker có thực hiện thành công hay không.

---

## II. Các bước thực hiện

### 1. Xác định mục tiêu tấn công brute force

**Truy vấn:**
```spl
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST src_ip="23.22.63.114"
```

**Giải thích:**
- Tìm kiếm các traffic với phương thức `POST` từ `src_ip` là `23.22.63.114` đến `dest_ip` là `192.168.250.70` của webserver.

**Kết quả:**
- Kiểm tra trong các fields `uri`, `uri_path`, ta thấy duy nhất một URI: `/joomla/administrator/index.php`.

---

### 2. Phân tích các giá trị brute force

**Truy vấn:**
```spl
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST uri="/joomla/administrator/index.php" | table _time uri src_ip dest_ip form_data
```

**Giải thích:**
- Tìm kiếm các traffic đến `uri` `/joomla/administrator/index.php` với phương thức `POST`.
- Lập bảng hiển thị các fields `_time`, `uri`, `src_ip`, `dest_ip`, và `form_data`.

**Kết quả:**
- Nhiều trường `username` có giá trị duy nhất là `admin` và nhiều trường `passwd` với giá trị khác nhau đến từ IP `23.22.63.114`.
- **Kết luận:** Attacker đang sử dụng một công cụ tự động brute force.

**Kiểm tra công cụ brute force:**
- Truy vấn lại và kiểm tra trường `http_user_agent`:
```spl
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST uri="/joomla/administrator/index.php"
```
- **Kết quả:**
  - Phát hiện `http_user_agent` là `Python-urllib/2.7`, một tập lệnh Python để brute force.

---

### 3. Trích xuất username và password bằng Regex

**Truy vấn:**
```spl
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST form_data=*username*passwd* | rex field=form_data "username=(?<username>\w+).*passwd=(?<passwd>\w+)" | table src_ip uri username passwd
```

**Giải thích:**
- Trích xuất các giá trị `username` và `password` trong trường `form_data` bằng Regex.
- Hiển thị bảng với các cột `src_ip`, `uri`, `username`, `passwd`.

**Kết quả:**
- Username: `admin`
- Password: `batman`

**Xác minh thêm:**
- Kiểm tra trường `http_user_agent`:
```spl
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST form_data=*username*passwd* | rex field=form_data "username=(?<username>\w+).*passwd=(?<passwd>\w+)" | table src_ip uri http_user_agent username passwd
```
- **Kết quả:** Attacker sử dụng IP `40.80.148.42` để đăng nhập với `username` là `admin` và `password` là `batman` qua trình duyệt Mozilla.

---

### 4. Đếm số lượng mật khẩu brute force

**Truy vấn:**
```spl
index=botsv1 sourcetype=stream:http src_ip=23.22.63.114 dest_ip="192.168.250.70" http_method=POST uri_path="/joomla/administrator/index.php" | rex field=form_data "passwd=(?<password>\w+)" | dedup password | stats count by password | stats sum(count) as count
```

**Giải thích:**
- Sử dụng `dedup password` để loại bỏ các mật khẩu trùng lặp.
- Đếm số lượng mật khẩu khác nhau.

**Kết quả:**
- Tổng số mật khẩu được thử: **412**

---

## III. Trả lời các câu hỏi

1. **What was the URI which got multiple brute force attempts?**
   - **Answer:** `/joomla/administrator/index.php`

2. **Against which username was the brute force attempt made?**
   - **Answer:** `admin`

3. **What was the correct password for admin access to the CMS?**
   - **Answer:** `batman`

4. **How many unique passwords were attempted in the brute force attempt?**
   - **Answer:** `412`

5. **What IP address is likely attempting a brute force password attack?**
   - **Answer:** `23.22.63.114`

6. **After finding the correct password, which IP did the attacker use to log in to the admin panel?**
   - **Answer:** `40.80.148.42`

---

## IV. Kết luận

Sau khi hoàn thành giai đoạn khai thác, chúng ta đã xác định được:

- **URI bị tấn công brute force:** `/joomla/administrator/index.php`
- **Username bị tấn công brute force:** `admin`
- **Mật khẩu chính xác:** `batman`
- **Số lượng mật khẩu khác nhau đã thử:** `412`
- **IP thực hiện brute force:** `23.22.63.114`
- **IP login thành công:** `40.80.148.42`
- **Tool brute force:** `Python-urllib/2.7`
