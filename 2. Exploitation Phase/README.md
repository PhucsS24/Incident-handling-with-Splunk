# Exploitation Phase

## I. Mục tiêu:
- Ở giai đoạn Reconnaissance chúng ta đã thu thập được các thông tin sau:
  - Các IP malicious thực hiện tấn công:
    - `40.80.148.42`
    - `23.22.63.114`
  - Địa chỉ IP của webserver:
    - `192.168.250.70`
  - CMS mà webserver sử dụng:
    - Joomla
  - Một nỗ lực tấn công brute force đến từ IP `23.22.63.114`

- Ở giai đoạn này chúng ta sẽ xem xét các khả năng tấn công brute force nhắm vào webserver và liệu attacker có thực hiện thành công không.

## II. Các bước thực hiện:

### 1. Xác định mục tiêu tấn công brute force:
- Đầu tiên, chúng ta cần xác định IP `23.22.63.114` thực hiện tấn công brute force nhắm vào trang nào. Có phải là trang admin của CMS Joomla hay không?

**Thực hiện truy vấn:**
```splunk
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST src_ip="23.22.63.114"
```
- **Giải thích:** Truy vấn tìm kiếm các traffic với method `POST` từ `src_ip="23.22.63.114"` đến `dest_ip="192.168.250.70"` của webserver.
- **Kết quả:** Kiểm tra trong các trường `uri`, `uri_path`, ta thấy chỉ có duy nhất một URI `/joomla/administrator/index.php` mà IP `23.22.63.114` đã truy cập đến thông qua method `POST`.

**Liên kết hình ảnh:**
- [Link hình ảnh tại đây]
- [Link hình ảnh Joomla tại đây]

### 2. Xác định thông tin brute force:
- Attacker tiến hành tấn công brute force thử nhiều username, password khác nhau đối với trang quản trị Joomla. Do đó chúng ta sẽ đào sâu vào các giá trị trong trường `form_data` để xem liệu attacker đã brute force thành công hay chưa.

**Thực hiện truy vấn:**
```splunk
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST uri="/joomla/administrator/index.php" | table _time uri src_ip dest_ip form_data
```
- **Giải thích:**
  - Tìm kiếm các traffic đến webserver có IP `192.168.250.70`, qua URI `/joomla/administrator/index.php` với method `POST`.
  - Lập bảng với các cột `_time`, `uri`, `src_ip`, `dest_ip`, `form_data`.

- **Kết quả:**
  - Tìm thấy rất nhiều trường username với giá trị duy nhất là `admin` và rất nhiều trường passwd với nhiều giá trị khác nhau đến từ IP `23.22.63.114`.

**Liên kết hình ảnh:**
- [Link hình ảnh tại đây]

### 3. Phát hiện công cụ brute force:
- Kiểm tra cột `_time`, khoảng cách thời gian giữa các lần brute force là rất ngắn, attacker đang sử dụng một tool tự động để thực hiện tấn công brute force. 

**Truy vấn:**
```splunk
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST uri="/joomla/administrator/index.php"
```
- **Kiểm tra trong trường `http_user_agent`**, xuất hiện `Python-urllib/2.7`. Đây là một tập lệnh Python để tự động tấn công brute force.

**Liên kết hình ảnh:**
- [Link hình ảnh tại đây]

### 4. Trích xuất password bằng Regex:
**Thực hiện truy vấn:**
```splunk
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST form_data=*username*passwd* | rex field=form_data "username=(?<username>\w+).*passwd=(?<passwd>\w+)" | table src_ip uri username passwd
```
- **Giải thích truy vấn:**
  - Tìm kiếm traffic đến webserver `192.168.250.70`, qua URI `/joomla/administrator/index.php` với method `POST`.
  - Trích xuất thông tin `username` và `password` từ trường `form_data` bằng Regex.
  - Lập bảng với các cột `src_ip`, `uri`, `username`, `passwd`.

- **Kết quả:** Trích xuất được tất cả các trường `username` và `password` mà IP `23.22.63.114` cố gắng brute force.

**Liên kết hình ảnh:**
- [Link hình ảnh tại đây]

### 5. Xác định IP login thành công:
- Ở dòng thứ hai của bảng, IP `40.80.148.42` truy cập URI `/joomla/administrator/index.php` và thực hiện login với `username=admin` và `password=batman`. Để chắc chắn cần thêm thông tin trường `http_user_agent`.

**Thực hiện truy vấn:**
```splunk
index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST form_data=*username*passwd* | rex field=form_data "username=(?<username>\w+).*passwd=(?<passwd>\w+)" | table src_ip uri http_user_agent username passwd
```
- **Kết quả:** Attacker sử dụng IP `40.80.148.42` để login thành công bằng trình duyệt Mozilla với `username=admin` và `password=batman`.

**Liên kết hình ảnh:**
- [Link hình ảnh tại đây]

## III. Trả lời các câu hỏi:

1. **What was the URI which got multiple brute force attempts?**
   - `/joomla/administrator/index.php`
   - **Giải thích:** Truy vấn `index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST src_ip="23.22.63.114"` cho thấy trường `uri` là `/joomla/administrator/index.php`.

2. **Against which username was the brute force attempt made?**
   - `admin`
   - **Giải thích:** Từ truy vấn, chỉ có username `admin` được brute force.

3. **What was the correct password for admin access to the content management system?**
   - `batman`
   - **Giải thích:** Truy vấn với status code `200` xác định password đúng là `batman`.

4. **How many unique passwords were attempted in the brute force attempt?**
   - `412`
   - **Giải thích:** Sử dụng truy vấn `dedup password` để đếm các password khác nhau.

5. **What IP address is likely attempting a brute force password attack?**
   - `23.22.63.114`
   - **Giải thích:** Truy vấn cho thấy nhiều request POST username và password từ IP này.

6. **After finding the correct password, which IP did the attacker use to log in to the admin panel?**
   - `40.80.148.42`
   - **Giải thích:** IP này thực hiện login thành công với Mozilla.

## IV. Kết luận:
- **Uri bị tấn công brute force:** `/joomla/administrator/index.php`
- **Username bị tấn công brute force:** `admin`
- **Mật khẩu chính xác:** `batman`
- **Số lượng password khác nhau:** `412`
- **IP brute force:** `23.22.63.114`
- **IP login thành công:** `40.80.148.42`
- **Tool brute force:** `Python-urllib/2.7`
